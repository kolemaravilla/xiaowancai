<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="theme-color" content="#3a1a28">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>For You</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100dvh;overflow:hidden;touch-action:manipulation;-webkit-user-select:none;user-select:none}
body{font-family:'Great Vibes',cursive;background:#3a1a28;display:flex;align-items:center;justify-content:center;position:relative}

/* ===== BACKGROUND LAYERS ===== */
.bg-base{position:fixed;inset:0;background:radial-gradient(ellipse at 30% 25%,#b05575 0%,transparent 60%),radial-gradient(ellipse at 70% 75%,#8c4060 0%,transparent 60%),radial-gradient(ellipse at 50% 50%,#6d3048 0%,#3a1a28 100%);z-index:0}
.bg-silk{position:fixed;inset:0;background:repeating-linear-gradient(110deg,transparent 0px,rgba(255,180,200,0.015) 2px,transparent 4px),repeating-linear-gradient(70deg,transparent 0px,rgba(255,120,160,0.01) 3px,transparent 6px);z-index:1}
.bg-shimmer{position:fixed;inset:0;background:linear-gradient(115deg,transparent 20%,rgba(255,200,220,0.06) 40%,rgba(255,180,200,0.1) 50%,rgba(255,200,220,0.06) 60%,transparent 80%);background-size:200% 100%;animation:shimmerMove 6s ease-in-out infinite;z-index:2;pointer-events:none}
@keyframes shimmerMove{0%{background-position:200% 0}100%{background-position:-200% 0}}
.bg-vignette{position:fixed;inset:0;background:radial-gradient(ellipse at center,transparent 50%,rgba(30,12,20,0.5) 100%);z-index:3;pointer-events:none}

/* ===== AMBIENT SPARKLES ===== */
.ambient-sparkle{position:fixed;width:3px;height:3px;background:radial-gradient(circle,rgba(255,215,0,0.9),transparent);border-radius:50%;pointer-events:none;z-index:4;animation:ambientTwinkle var(--dur) ease-in-out infinite;animation-delay:var(--del)}
@keyframes ambientTwinkle{0%,100%{opacity:0;transform:scale(0.5)}50%{opacity:1;transform:scale(1.2)}}

/* ===== ORNAMENTAL CORNERS ===== */
.corner{position:fixed;font-size:1.8rem;color:rgba(255,215,0,0.15);z-index:5;pointer-events:none}
.corner-tl{top:12px;left:12px}
.corner-tr{top:12px;right:12px;transform:scaleX(-1)}
.corner-bl{bottom:12px;left:12px;transform:scaleY(-1)}
.corner-br{bottom:12px;right:12px;transform:scale(-1)}

/* ===== HEART CONTAINER ===== */
#heartContainer{position:relative;width:min(85vw,340px);height:min(95vw,380px);z-index:30;opacity:0;animation:cardFadeIn 1.5s ease 0.3s forwards}
@keyframes cardFadeIn{from{opacity:0;transform:scale(0.92)}to{opacity:1;transform:scale(1)}}
#heartContainer::before{content:'';position:absolute;inset:-30px;background:radial-gradient(ellipse at center,rgba(255,182,193,0.12) 0%,transparent 70%);z-index:-1;border-radius:50%}

@keyframes celebratePulse{0%{filter:drop-shadow(0 0 10px rgba(255,100,150,0.2))}30%{filter:drop-shadow(0 0 50px rgba(255,100,150,0.9))}100%{filter:drop-shadow(0 0 20px rgba(255,100,150,0.4))}}
#heartContainer.celebrate{animation:celebratePulse 1s ease-out forwards}

/* ===== FLOWERS ===== */
.flower{position:absolute;line-height:1;transform-origin:center;animation:flowerSway var(--dur,3s) ease-in-out infinite alternate;animation-delay:var(--del,0s);filter:drop-shadow(0 0 2px rgba(255,150,180,0.4));z-index:31;pointer-events:none}
@keyframes flowerSway{0%{transform:rotate(calc(var(--rot,0deg) - 6deg)) scale(0.93)}100%{transform:rotate(calc(var(--rot,0deg) + 6deg)) scale(1.07)}}

/* ===== QUESTION TEXT ===== */
#questionText{position:absolute;top:50%;left:50%;transform:translate(-50%,-55%);text-align:center;font-family:'Great Vibes',cursive;font-weight:bold;font-size:clamp(1.8rem,7vw,2.6rem);line-height:1.35;z-index:32;background:linear-gradient(90deg,#9B0E2B,#4A0878,#7D1818,#2D3A8E,#9B0E2B,#4A0878,#7D1818);background-size:400% 100%;-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.7));animation:textGlitter 30s linear infinite;max-width:70%;transition:opacity 0.4s ease}
@keyframes textGlitter{0%{background-position:0% 50%}100%{background-position:400% 50%}}

/* ===== NAMES TEXT ===== */
#namesText{position:absolute;top:50%;left:50%;transform:translate(-50%,-52%);text-align:center;font-family:'Great Vibes',cursive;font-weight:bold;font-size:clamp(2rem,7vw,2.6rem);line-height:1.25;z-index:32;opacity:0;pointer-events:none;transition:opacity 0.8s ease;max-width:80%;background:linear-gradient(90deg,#9B0E2B,#4A0878,#7D1818,#2D3A8E,#9B0E2B,#4A0878,#7D1818);background-size:400% 100%;-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.7));animation:textGlitter 30s linear infinite}
#namesText.show{opacity:1;pointer-events:auto}
#namesText .plus{font-size:0.85em}

/* ===== TEXT SPARKLES ===== */
.text-sparkle{position:absolute;width:var(--s,3px);height:var(--s,3px);background:radial-gradient(circle,#ffd700,transparent);border-radius:50%;pointer-events:none;z-index:33;animation:textSpark var(--dur,2s) ease-in-out infinite;animation-delay:var(--del,0s)}
@keyframes textSpark{0%,100%{opacity:0;transform:scale(0)}40%{opacity:1;transform:scale(1.5)}60%{opacity:0.8;transform:scale(1)}}

/* ===== BUTTONS ===== */
#buttonsContainer{position:absolute;top:100%;left:50%;transform:translateX(-50%);display:flex;gap:24px;z-index:35;margin-top:8px;transition:opacity 0.3s ease}
.btn{padding:14px 36px;border:none;border-radius:30px;font-family:'Great Vibes',cursive;font-size:1.4rem;cursor:pointer;-webkit-tap-highlight-color:transparent;transition:transform 0.15s,box-shadow 0.15s;letter-spacing:1px}
.btn:active{transform:scale(0.93)}
#yesBtn{background:linear-gradient(135deg,#dc143c,#ff2d55);color:#fff;box-shadow:0 4px 20px rgba(220,20,60,0.5);border:2px solid rgba(255,255,255,0.2)}
#noBtn{background:linear-gradient(135deg,#fff,#f5f0f0);color:#555;box-shadow:0 4px 20px rgba(0,0,0,0.12);border:2px solid rgba(200,180,180,0.3)}

/* ===== DUDU POPUP ===== */
#duduPopup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);z-index:200;pointer-events:none;transition:transform 0.12s cubic-bezier(0.34,1.56,0.64,1)}
#duduPopup.show{transform:translate(-50%,-50%) scale(1)}
#duduPopup img{width:min(40vw,180px);height:auto;filter:drop-shadow(0 5px 20px rgba(0,0,0,0.5))}
@keyframes duduShake{0%,100%{transform:rotate(0)}20%{transform:rotate(-12deg)}40%{transform:rotate(10deg)}60%{transform:rotate(-8deg)}80%{transform:rotate(6deg)}}

/* ===== FIREWORKS CANVAS ===== */
#fireworksCanvas{position:fixed;inset:0;width:100%;height:100%;z-index:40;pointer-events:none}

/* ===== FALLING EMOJIS ===== */
.falling-emoji{position:fixed;top:-60px;z-index:60;pointer-events:none;will-change:transform;animation:emojifall var(--dur,5s) linear forwards}
@keyframes emojifall{0%{transform:translateY(0) rotate(0deg);opacity:1}85%{opacity:1}100%{transform:translateY(calc(100dvh + 80px)) rotate(var(--spin,360deg));opacity:0}}

/* ===== PHOTO ELEMENTS ===== */
.photo-el{position:fixed;z-index:50;pointer-events:none;border:4px solid white;border-bottom-width:18px;border-radius:2px;box-shadow:0 6px 25px rgba(0,0,0,0.4);overflow:hidden;will-change:transform,opacity;animation:photoGlide var(--dur,6s) linear forwards}
@keyframes photoGlide{0%{transform:translate(0,0) rotate(var(--rot,0deg));opacity:0}8%{opacity:1}85%{opacity:1}100%{transform:translate(var(--tx,0px),var(--ty,0px)) rotate(var(--rot,0deg));opacity:0}}
.photo-el img{width:100%;height:100%;object-fit:cover;display:block}
</style>
</head>
<body>

<div class="bg-base"></div>
<div class="bg-silk"></div>
<div class="bg-shimmer"></div>
<div class="bg-vignette"></div>

<div class="corner corner-tl">&#10086;</div>
<div class="corner corner-tr">&#10086;</div>
<div class="corner corner-bl">&#10086;</div>
<div class="corner corner-br">&#10086;</div>

<div id="heartContainer">
  <div id="questionText">Will you be<br>my Valentine?</div>
  <div id="namesText">Hannah<br><span class="plus">+</span><br>Kole</div>
  <div id="buttonsContainer">
    <button class="btn" id="yesBtn">Yes</button>
    <button class="btn" id="noBtn">No</button>
  </div>
</div>

<div id="duduPopup"><img src="angry_dudu.png" alt=""></div>
<canvas id="fireworksCanvas"></canvas>

<script>
/* ==========================================
   DATA
   ========================================== */
const PHOTOS = [
  'IMG_0235_Medium.jpeg','IMG_0431_Medium.jpeg','IMG_0489_Medium.jpeg',
  'IMG_0594_Medium.jpeg','IMG_1170_Medium.jpeg','IMG_1218_Medium.jpeg',
  'IMG_1220_Medium.jpeg','IMG_1247_Medium.jpeg','IMG_1252_Medium.jpeg',
  'IMG_1254_Medium.jpeg','IMG_1262_Medium.jpeg','IMG_1537_Medium.jpeg',
  'IMG_1629_Medium.jpeg','IMG_1902_Medium.jpeg','IMG_8695_Medium.jpeg',
  'IMG_8715_Medium.jpeg','IMG_9079_Medium.jpeg','IMG_9175_Medium.jpeg',
  'IMG_9228_Medium.jpeg','IMG_9458_Medium.jpeg','IMG_9558_Medium.jpeg',
  'IMG_9599_Medium.jpeg','IMG_9966_Medium.jpeg',
  'adf7aa7de9ae8300eb5d887430602ec8_Medium.jpeg',
  'b279309662bcc99322e6a64b88bd1b56_Medium.jpeg',
  'b656e7f89aff700fa0709ad5cf946ea2_Medium.jpeg',
  'c39f3a5ef09b74cb171f889e826eac2e_Medium.jpeg',
  'd26207eef9a176c3924ed7fdd73a17c2_Medium.jpeg'
];
const FLOWER_POOL = [
  {e:'\u{1F338}',w:6},{e:'\u{1F33A}',w:4},{e:'\u{1F339}',w:5},{e:'\u{1F337}',w:4},
  {e:'\u{1FAB7}',w:3},{e:'\u{1F4AE}',w:2},{e:'\u{1FAB7}',w:2},{e:'\u{1F33C}',w:1},
  {e:'\u{1F33F}',w:1},{e:'\u{1F343}',w:1}
];
const CELEBRATION_EMOJIS = ['\u2764\uFE0F','\u{1F495}','\u{1F49D}','\u{1F496}','\u{1F339}','\u{1F490}','\u{1F338}','\u{1F36B}','\u{1F9E7}','\u{1F63B}','\u{1F497}','\u{1FAF6}'];

// Preload
PHOTOS.forEach(s=>{const i=new Image();i.src=s});
const duduImg=new Image();duduImg.src='angry_dudu.png';

/* ==========================================
   HEART MATH
   ========================================== */
function heartXY(t){
  return{
    x:16*Math.pow(Math.sin(t),3),
    y:-(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t))
  };
}

/* ==========================================
   FLOWER HEART
   ========================================== */
function pickFlower(){
  const total=FLOWER_POOL.reduce((s,f)=>s+f.w,0);
  let r=Math.random()*total;
  for(const f of FLOWER_POOL){r-=f.w;if(r<=0)return f.e}
  return'\u{1F338}';
}

function generateFlowerHeart(){
  const c=document.getElementById('heartContainer');
  const cw=c.offsetWidth,ch=c.offsetHeight;
  const pts=[];
  for(let i=0;i<200;i++)pts.push(heartXY((i/200)*Math.PI*2));
  const xs=pts.map(p=>p.x),ys=pts.map(p=>p.y);
  const minX=Math.min(...xs),maxX=Math.max(...xs);
  const minY=Math.min(...ys),maxY=Math.max(...ys);
  const pad=22;
  const scale=Math.min((cw-pad*2)/(maxX-minX),(ch-pad*2)/(maxY-minY));
  const offX=cw/2-((minX+maxX)/2)*scale;
  const offY=ch/2-((minY+maxY)/2)*scale-8;

  const numFlowers=75;
  for(let i=0;i<numFlowers;i++){
    const t=(i/numFlowers)*Math.PI*2;
    const p=heartXY(t);
    const scatter=(Math.random()-0.5)*14;
    const scatterY=(Math.random()-0.5)*14;
    const sx=p.x*scale+offX+scatter;
    const sy=p.y*scale+offY+scatterY;
    const fl=document.createElement('div');
    fl.className='flower';
    fl.textContent=pickFlower();
    const sz=15+Math.random()*10;
    fl.style.cssText='left:'+(sx-sz/2)+'px;top:'+(sy-sz/2)+'px;font-size:'+sz+'px;--dur:'+(2.5+Math.random()*2)+'s;--del:'+(-Math.random()*3)+'s;--rot:'+(Math.random()-0.5)*10+'deg';
    c.appendChild(fl);
  }
  // Inner ring for fullness
  for(let i=0;i<30;i++){
    const t=(i/30)*Math.PI*2;
    const p=heartXY(t);
    const innerScale=0.82;
    const sx=p.x*scale*innerScale+offX+(Math.random()-0.5)*8;
    const sy=p.y*scale*innerScale+offY+(Math.random()-0.5)*8;
    const fl=document.createElement('div');
    fl.className='flower';
    fl.textContent=pickFlower();
    const sz=12+Math.random()*8;
    fl.style.cssText='left:'+(sx-sz/2)+'px;top:'+(sy-sz/2)+'px;font-size:'+sz+'px;--dur:'+(2.5+Math.random()*2)+'s;--del:'+(-Math.random()*3)+'s;--rot:'+(Math.random()-0.5)*10+'deg;opacity:0.75';
    c.appendChild(fl);
  }
}

/* ==========================================
   TEXT SPARKLES
   ========================================== */
function addSparklesFor(el){
  const c=document.getElementById('heartContainer');
  const rect=el.getBoundingClientRect();
  const cRect=c.getBoundingClientRect();
  for(let i=0;i<22;i++){
    const sp=document.createElement('div');
    sp.className='text-sparkle';
    const x=(rect.left-cRect.left)-8+Math.random()*(rect.width+16);
    const y=(rect.top-cRect.top)-8+Math.random()*(rect.height+16);
    const s=2+Math.random()*3;
    sp.style.cssText='left:'+x+'px;top:'+y+'px;--s:'+s+'px;--dur:'+(1.5+Math.random()*2)+'s;--del:'+(-Math.random()*3)+'s';
    c.appendChild(sp);
  }
}

/* ==========================================
   AMBIENT SPARKLES
   ========================================== */
function generateAmbientSparkles(){
  for(let i=0;i<25;i++){
    const sp=document.createElement('div');
    sp.className='ambient-sparkle';
    sp.style.cssText='left:'+Math.random()*100+'%;top:'+Math.random()*100+'%;--dur:'+(2+Math.random()*3)+'s;--del:'+(-Math.random()*4)+'s';
    document.body.appendChild(sp);
  }
}

/* ==========================================
   NO BUTTON DODGE
   ========================================== */
const yesBtn=document.getElementById('yesBtn');
const noBtn=document.getElementById('noBtn');
const duduPopup=document.getElementById('duduPopup');
let noDodging=false,duduTimer=null;

function dodgeNoBtn(){
  const prevX=parseFloat(noBtn.style.left);
  const prevY=parseFloat(noBtn.style.top);
  const hasPrev=!isNaN(prevX);
  if(!noDodging){
    noDodging=true;
    document.body.appendChild(noBtn);
    noBtn.style.position='fixed';
    noBtn.style.zIndex='35';
    noBtn.style.margin='0';
  }
  const bw=noBtn.offsetWidth,bh=noBtn.offsetHeight;
  const yR=yesBtn.getBoundingClientRect();
  const dW=Math.min(window.innerWidth*0.4,180);
  const dCx=window.innerWidth/2,dCy=window.innerHeight/2;
  const dR={left:dCx-dW/2-20,right:dCx+dW/2+20,top:dCy-dW/2-20,bottom:dCy+dW/2+20};
  const minDist=150;
  const pad=15;
  let x,y,att=0;
  do{
    x=pad+Math.random()*(window.innerWidth-bw-pad*2);
    y=pad+Math.random()*(window.innerHeight-bh-pad*2);
    att++;
    const nR={left:x,right:x+bw,top:y,bottom:y+bh};
    const hitYes=!(nR.right+20<yR.left||nR.left-20>yR.right||nR.bottom+20<yR.top||nR.top-20>yR.bottom);
    const hitDudu=!(nR.right<dR.left||nR.left>dR.right||nR.bottom<dR.top||nR.top>dR.bottom);
    const dx=x-prevX,dy=y-prevY;
    const farEnough=!hasPrev||Math.sqrt(dx*dx+dy*dy)>=minDist;
    if(!hitYes&&!hitDudu&&farEnough)break;
  }while(att<80);
  noBtn.style.left=x+'px';
  noBtn.style.top=y+'px';
  showDudu();
  playGrumble();
}

function showDudu(){
  if(duduTimer)clearTimeout(duduTimer);
  duduPopup.classList.add('show');
  const img=duduPopup.querySelector('img');
  img.style.animation='none';img.offsetHeight;img.style.animation='duduShake 0.4s ease-in-out';
  duduTimer=setTimeout(()=>duduPopup.classList.remove('show'),700);
}

/* ==========================================
   GRUMBLE SOUND (Web Audio)
   ========================================== */
let audioCtx;
function playGrumble(){
  try{
    if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();
    if(audioCtx.state==='suspended')audioCtx.resume();
    const now=audioCtx.currentTime,dur=0.32;
    const o1=audioCtx.createOscillator();o1.type='sawtooth';
    o1.frequency.setValueAtTime(90,now);o1.frequency.linearRampToValueAtTime(55,now+dur);
    const o2=audioCtx.createOscillator();o2.type='square';
    o2.frequency.setValueAtTime(175,now);o2.frequency.linearRampToValueAtTime(110,now+dur);
    const bufSz=audioCtx.sampleRate*dur;
    const nBuf=audioCtx.createBuffer(1,bufSz,audioCtx.sampleRate);
    const d=nBuf.getChannelData(0);for(let i=0;i<bufSz;i++)d[i]=(Math.random()*2-1)*0.25;
    const noise=audioCtx.createBufferSource();noise.buffer=nBuf;
    const g1=audioCtx.createGain();g1.gain.setValueAtTime(0.2,now);g1.gain.linearRampToValueAtTime(0,now+dur);
    const g2=audioCtx.createGain();g2.gain.setValueAtTime(0.08,now);g2.gain.linearRampToValueAtTime(0,now+dur);
    const gn=audioCtx.createGain();gn.gain.setValueAtTime(0.06,now);gn.gain.linearRampToValueAtTime(0,now+dur);
    const lp=audioCtx.createBiquadFilter();lp.type='lowpass';lp.frequency.value=400;
    o1.connect(g1);g1.connect(lp);o2.connect(g2);g2.connect(lp);noise.connect(gn);gn.connect(lp);lp.connect(audioCtx.destination);
    o1.start(now);o2.start(now);noise.start(now);
    o1.stop(now+dur);o2.stop(now+dur);noise.stop(now+dur);
  }catch(e){}
}

let lastDodge=0;
function handleNoDodge(e){
  e.preventDefault();
  const now=Date.now();
  if(now-lastDodge<200)return;
  lastDodge=now;
  dodgeNoBtn();
}
noBtn.addEventListener('touchstart',handleNoDodge,{passive:false});
noBtn.addEventListener('pointerdown',handleNoDodge,{passive:false});

/* ==========================================
   YES â†’ CELEBRATION
   ========================================== */
let celebrating=false;
yesBtn.addEventListener('pointerdown',e=>{
  e.preventDefault();
  if(celebrating)return;
  celebrating=true;
  startCelebration();
},{passive:false});

function startCelebration(){
  document.getElementById('buttonsContainer').style.display='none';
  if(noDodging)noBtn.style.display='none';
  document.getElementById('questionText').style.display='none';
  document.querySelectorAll('.text-sparkle').forEach(el=>el.remove());
  const hc=document.getElementById('heartContainer');
  hc.style.opacity='1';
  hc.style.filter='drop-shadow(0 0 20px rgba(255,100,150,0.4))';
  const names=document.getElementById('namesText');
  names.classList.add('show');
  setTimeout(()=>addSparklesFor(names),400);
  startFireworks();
  startFallingEmojis();
  startPhotoSpray();
}

/* ==========================================
   FIREWORKS (Canvas)
   ========================================== */
const canvas=document.getElementById('fireworksCanvas');
const fctx=canvas.getContext('2d');
let particles=[];

function resizeCanvas(){
  const dpr=window.devicePixelRatio||1;
  canvas.width=canvas.clientWidth*dpr;
  canvas.height=canvas.clientHeight*dpr;
  fctx.setTransform(dpr,0,0,dpr,0,0);
}
window.addEventListener('resize',resizeCanvas);
resizeCanvas();

const FW_COLORS=['#ff1744','#ff4081','#f50057','#ff6090','#ffd700','#ffab40','#ff80ab','#ea80fc','#ff5252','#ffffff','#e040fb','#ff8a80'];

function drawTinyHeart(ctx,cx,cy,size){
  ctx.save();ctx.translate(cx,cy);ctx.beginPath();
  ctx.moveTo(0,-size*0.3);
  ctx.bezierCurveTo(-size*0.5,-size,-size,-size*0.3,0,size*0.5);
  ctx.moveTo(0,-size*0.3);
  ctx.bezierCurveTo(size*0.5,-size,size,-size*0.3,0,size*0.5);
  ctx.fill();ctx.restore();
}

function launchFirework(){
  const cx=Math.random()*window.innerWidth;
  const cy=Math.random()*window.innerHeight*0.6;
  const color=FW_COLORS[Math.floor(Math.random()*FW_COLORS.length)];
  const isHeart=Math.random()<0.35;
  const count=isHeart?55:40+Math.floor(Math.random()*25);
  if(isHeart){
    for(let i=0;i<count;i++){
      const t=(i/count)*Math.PI*2;
      const hx=16*Math.pow(Math.sin(t),3);
      const hy=-(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
      const spd=2.2+Math.random()*1.5;
      particles.push({x:cx,y:cy,vx:hx*spd,vy:hy*spd,color:color,life:1.5+Math.random()*0.5,maxLife:2,size:2.5,heart:Math.random()<0.25});
    }
  }else{
    for(let i=0;i<count;i++){
      const a=Math.random()*Math.PI*2;
      const spd=40+Math.random()*120;
      particles.push({x:cx,y:cy,vx:Math.cos(a)*spd,vy:Math.sin(a)*spd,color:color,life:1.2+Math.random()*0.8,maxLife:2,size:2+Math.random()*1.5,heart:false});
    }
  }
}

let lastT=0;
function fireworkLoop(time){
  const dt=Math.min((time-lastT)/1000,0.05);
  lastT=time;
  fctx.clearRect(0,0,window.innerWidth,window.innerHeight);
  if(celebrating){
    for(let i=particles.length-1;i>=0;i--){
      const p=particles[i];
      p.x+=p.vx*dt;p.y+=p.vy*dt;p.vy+=80*dt;p.vx*=0.99;p.life-=dt;
      if(p.life<=0){particles.splice(i,1);continue}
      const alpha=Math.max(0,p.life/p.maxLife);
      fctx.globalAlpha=alpha;fctx.fillStyle=p.color;
      if(p.heart){drawTinyHeart(fctx,p.x,p.y,p.size*1.5)}
      else{fctx.beginPath();fctx.arc(p.x,p.y,p.size*alpha,0,Math.PI*2);fctx.fill()}
    }
    fctx.globalAlpha=1;
    if(particles.length>600)particles.splice(0,particles.length-500);
  }
  requestAnimationFrame(fireworkLoop);
}
requestAnimationFrame(fireworkLoop);

function startFireworks(){
  for(let i=0;i<5;i++)setTimeout(()=>launchFirework(),i*200);
  setInterval(()=>{
    const n=1+Math.floor(Math.random()*2);
    for(let i=0;i<n;i++)setTimeout(()=>launchFirework(),i*300);
  },2500);
}

/* ==========================================
   FALLING EMOJIS
   ========================================== */
function spawnEmoji(){
  const em=CELEBRATION_EMOJIS[Math.floor(Math.random()*CELEBRATION_EMOJIS.length)];
  const el=document.createElement('div');
  el.className='falling-emoji';el.textContent=em;
  const dur=4+Math.random()*3;
  const spin=(Math.random()<0.5?'':'-')+(180+Math.random()*360);
  el.style.cssText='left:'+Math.random()*(window.innerWidth-40)+'px;--dur:'+dur+'s;--spin:'+spin+'deg;font-size:'+(20+Math.random()*18)+'px';
  document.body.appendChild(el);
  setTimeout(()=>el.remove(),dur*1000+100);
}
function startFallingEmojis(){
  spawnEmoji();
  setInterval(spawnEmoji,450);
}

/* ==========================================
   PHOTO SPRAY
   ========================================== */
let photoIdx=0;
let shuffled=[...PHOTOS];
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}

function spawnPhoto(){
  if(photoIdx>=shuffled.length){photoIdx=0;shuffled=shuffle([...PHOTOS])}
  const src=shuffled[photoIdx++];
  const el=document.createElement('div');
  el.className='photo-el';
  const size=95+Math.random()*45;
  const rot=(Math.random()-0.5)*30;
  const x=-size/2+Math.random()*window.innerWidth;
  const y=-size/2+Math.random()*window.innerHeight;
  const angle=Math.random()*Math.PI*2;
  const dist=150+Math.random()*200;
  const tx=Math.cos(angle)*dist;
  const ty=Math.sin(angle)*dist;
  const dur=5+Math.random()*3;
  el.style.cssText='left:'+x+'px;top:'+y+'px;width:'+size+'px;height:'+size+'px;--rot:'+rot+'deg;--tx:'+tx+'px;--ty:'+ty+'px;--dur:'+dur+'s';
  const img=document.createElement('img');img.src=src;img.alt='';
  el.appendChild(img);document.body.appendChild(el);
  setTimeout(()=>el.remove(),dur*1000+100);
}

function startPhotoSpray(){
  shuffled=shuffle([...PHOTOS]);photoIdx=0;
  for(let i=0;i<3;i++)setTimeout(()=>spawnPhoto(),i*300);
  setInterval(spawnPhoto,1200);
}

/* ==========================================
   INIT
   ========================================== */
window.addEventListener('load',()=>{
  generateFlowerHeart();
  generateAmbientSparkles();
  setTimeout(()=>addSparklesFor(document.getElementById('questionText')),500);
});
document.addEventListener('touchmove',e=>e.preventDefault(),{passive:false});
</script>
</body>
</html>
